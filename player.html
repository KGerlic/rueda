<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Odtwarzacz MP3 — Rueda de Casino</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="style.css" rel="stylesheet" type="text/css" />

  <style>
    /* Tylko dla player.html — proste UI playlisty */
    .player-panel {
      display: grid;
      gap: 14px;
      max-width: 820px;
    }

    .tempo-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .tempo-btn {
      appearance: none;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text-main);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 650;
      letter-spacing: 0.02em;
      line-height: 1;
      user-select: none;
    }

    .tempo-btn:hover {
      border-color: rgba(238, 0, 0, 0.65);
      background: rgba(238, 0, 0, 0.10);
    }

    .tempo-btn[aria-pressed="true"] {
      border-color: rgba(238, 0, 0, 0.95);
      background: rgba(238, 0, 0, 0.18);
    }

    .now-playing {
      color: var(--text-muted);
      font-size: 0.98rem;
    }

    .note {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <div class="page-wrapper">
    <h2 class="page-title">
      Odtwarzacz MP3
      <a class="player-link" href="index.html" aria-label="Powrót do tabeli" title="Powrót">
        <img src="assets/icons/player.png" alt="" width="64" height="64" />
      </a>
    </h2>
    <div class="player-panel">
      <div class="tempo-row" id="tempoRow" aria-label="Wybór prędkości BPM">
        <!-- Przyciski generowane w JS -->
      </div>

      <audio id="audio" controls preload="auto" style="width: 100%;">
        <source id="audioSource" src="" type="audio/mpeg">
        Twoja przeglądarka nie obsługuje odtwarzacza audio.
      </audio>

      <div class="now-playing" id="nowPlaying">Ładowanie…</div>

      <div class="note">
        Uwaga: przeglądarka może blokować autoodtwarzanie. Jeśli tak się stanie, kliknij „Play”.
      </div>
    </div>
  </div>

  <script>
    // 1) Lista dostępnych temp (dopisz/usuwaj wg plików w assets/mp3/)
    //    Nazwy plików zakładamy w formacie: "<BPM>-bpm.mp3"
    const TEMPOS = [100, 120, 140, 160, 180, 200];

    // 2) Ustaw tempo domyślne (masz na pewno 140-bpm.mp3)
    const DEFAULT_BPM = 140;

    const tempoRow = document.getElementById("tempoRow");
    const audio = document.getElementById("audio");
    const audioSource = document.getElementById("audioSource");
    const nowPlaying = document.getElementById("nowPlaying");

    function fileFor(bpm) {
      return `assets/mp3/${bpm}-bpm.mp3`;
    }

    function setActiveButton(bpm) {
      [...tempoRow.querySelectorAll("button")].forEach(btn => {
        const isActive = Number(btn.dataset.bpm) === bpm;
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
      });
    }

    async function tryAutoplay() {
      try {
        await audio.play();
      } catch (e) {
        // Autoplay blocked – użytkownik musi kliknąć Play
      }
    }

    function loadTempo(bpm) {
      const src = fileFor(bpm);

      setActiveButton(bpm);
      nowPlaying.textContent = `Wybrane tempo: ${bpm} BPM — plik: ${bpm}-bpm.mp3`;

      // Zachowaj pozycję/stan jeśli chcesz (tu: resetujemy do początku)
      audio.pause();
      audio.currentTime = 0;

      audioSource.src = src;
      audio.load();

      // Próba autoodtwarzania
      tryAutoplay();
    }

    // Budowa przycisków
    TEMPOS.forEach(bpm => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "tempo-btn";
      btn.dataset.bpm = String(bpm);
      btn.setAttribute("aria-pressed", "false");
      btn.textContent = `${bpm} BPM`;

      btn.addEventListener("click", () => loadTempo(bpm));
      tempoRow.appendChild(btn);
    });

    // Start: ładujemy domyślny plik
    loadTempo(DEFAULT_BPM);

    // Opcjonalnie: po zakończeniu utworu ponów odtwarzanie (loop)
    // Jeśli nie chcesz zapętlania, usuń tę linijkę:
    audio.loop = true;
  </script>
</body>
</html>
